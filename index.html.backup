<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¤¾äº¤åª’ä½“å‘å¸ƒæ—¥å†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700&family=Work+Sans:wght@100;200;300;400;500;600;700&family=Source+Sans+Pro:wght@200;300;400;600;700&family=Poppins:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Work Sans', -apple-system, BlinkMacSystemFont, sans-serif; 
            background: #f8f9fa;
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .calendar-cell {
            border: 1px solid #e5e7eb;
            transition: all 0.2s ease;
        }
        .calendar-cell:hover {
            border-color: #d1d5db;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .today-cell {
            background-color: #86efac !important;
            border-color: #22c55e;
        }
        .past-cell {
            background-color: #f9fafb;
            color: #9ca3af;
        }
        .carousel-indicator {
            transition: all 0.3s ease;
        }
        .aspect-9-16 {
            aspect-ratio: 9 / 16;
        }
        .media-container {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        .media-container img,
        .media-container video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
        }
        .nav-button {
            min-width: 48px;
            min-height: 48px;
            flex-shrink: 0;
        }
    </style>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="min-h-screen bg-gray-50 p-6 font-sans antialiased">
    <div id="root"></div>

    <script type="text/babel">
        // Simple icons using Unicode symbols
        const ChevronLeft = () => <span>â€¹</span>;
        const ChevronRight = () => <span>â€º</span>;
        const PlusCircle = () => <span>+</span>;
        const XCircle = () => <span>Ã—</span>;
        const UploadCloud = () => <span>ğŸ“</span>;
        const CalendarPlus = () => <span>ğŸ“…</span>;
        const ExternalLink = () => <span>ğŸ”—</span>;

        const App = () => {
            const [currentDate, setCurrentDate] = React.useState(new Date());
            const [scheduledPosts, setScheduledPosts] = React.useState(() => {
                // ä»localStorageåŠ è½½å·²ä¿å­˜çš„æ•°æ®
                try {
                    const saved = localStorage.getItem('socialMediaCalendar');
                    return saved ? JSON.parse(saved) : {};
                } catch (error) {
                    console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                    return {};
                }
            });
            const [showModal, setShowModal] = React.useState(false);
            const [selectedDay, setSelectedDay] = React.useState(null);
            const [selectedFiles, setSelectedFiles] = React.useState([]);
            const [selectedPlatforms, setSelectedPlatforms] = React.useState([]);
            const [captionInput, setCaptionInput] = React.useState('');
            const [message, setMessage] = React.useState({ text: '', type: '' });
            const [currentView, setCurrentView] = React.useState('calendar');
            const [currentTime, setCurrentTime] = React.useState(new Date());
            const [lightboxMedia, setLightboxMedia] = React.useState(null);
            const [carouselIndices, setCarouselIndices] = React.useState({});
            const [notificationsEnabled, setNotificationsEnabled] = React.useState(false);

            const platforms = [
                { name: 'IG', url: 'https://www.instagram.com/' },
                { name: 'FB', url: 'https://www.facebook.com/' },
                { name: 'å°çº¢ä¹¦', url: 'https://www.xiaohongshu.com/' },
                { name: 'å¾®ä¿¡', url: 'https://weixin.qq.com/' },
                { name: 'TIKTOK', url: 'https://www.tiktok.com/' },
                { name: 'æŠ–éŸ³', url: 'https://www.douyin.com/' }
            ];

            // è‡ªåŠ¨ä¿å­˜æ•°æ®åˆ°localStorage
            React.useEffect(() => {
                try {
                    // æ£€æŸ¥æ•°æ®å¤§å°
                    const dataStr = JSON.stringify(scheduledPosts);
                    const dataSize = new Blob([dataStr]).size / 1024 / 1024; // MB
                    
                    if (dataSize > 5) {
                        console.warn('æ•°æ®è¿‡å¤§ï¼Œå¯èƒ½æ— æ³•å®Œå…¨ä¿å­˜åˆ°localStorage');
                        showTemporaryMessage('æ•°æ®é‡è¾ƒå¤§ï¼Œå»ºè®®å®šæœŸå¯¼å‡ºå¤‡ä»½', 'error');
                    }
                    
                    localStorage.setItem('socialMediaCalendar', dataStr);
                } catch (error) {
                    console.error('ä¿å­˜æ•°æ®å¤±è´¥:', error);
                    showTemporaryMessage('å­˜å‚¨ç©ºé—´ä¸è¶³ï¼Œè¯·å¯¼å‡ºæ•°æ®æˆ–æ¸…ç†éƒ¨åˆ†å†…å®¹', 'error');
                }
            }, [scheduledPosts]);

            React.useEffect(() => {
                const timer = setInterval(() => {
                    setCurrentTime(new Date());
                }, 1000);
                return () => clearInterval(timer);
            }, []);

            // é”®ç›˜äº‹ä»¶ç›‘å¬ - ESCé”®å…³é—­Lightbox
            React.useEffect(() => {
                const handleKeyDown = (event) => {
                    if (event.key === 'Escape' && lightboxMedia) {
                        closeLightbox();
                    }
                };

                document.addEventListener('keydown', handleKeyDown);
                return () => document.removeEventListener('keydown', handleKeyDown);
            }, [lightboxMedia]);

            // åˆå§‹åŒ–é€šçŸ¥æƒé™å’Œå®šæ—¶æ£€æŸ¥
            React.useEffect(() => {
                const savedNotificationState = localStorage.getItem('notificationsEnabled');
                if (savedNotificationState === 'true' && 'Notification' in window && Notification.permission === 'granted') {
                    setNotificationsEnabled(true);
                }

                // æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ˜¯å¦éœ€è¦å‘é€æé†’
                const checkInterval = setInterval(() => {
                    const now = new Date();
                    // åœ¨9:00, 12:00, 15:00, 18:00 çš„æ•´ç‚¹æé†’
                    if ([9, 12, 15, 18].includes(now.getHours()) && now.getMinutes() === 0 && now.getSeconds() < 5) {
                        checkTodaysPosts();
                    }
                }, 1000);

                return () => clearInterval(checkInterval);
            }, [scheduledPosts, notificationsEnabled]);

            const showTemporaryMessage = (text, type = 'success') => {
                if (type === 'error') {
                    setMessage({ text, type });
                    setTimeout(() => setMessage({ text: '', type: '' }), 3000);
                }
            };

            const prevMonth = () => {
                setCurrentDate(prevDate => {
                    const newDate = new Date(prevDate.getFullYear(), prevDate.getMonth() - 1, 1);
                    return newDate;
                });
            };

            const nextMonth = () => {
                setCurrentDate(prevDate => {
                    const newDate = new Date(prevDate.getFullYear(), prevDate.getMonth() + 1, 1);
                    return newDate;
                });
            };

            const openModal = (day) => {
                setSelectedDay(day);
                setSelectedFiles([]);
                setSelectedPlatforms([]);
                setCaptionInput('');
                setShowModal(true);
            };

            const closeModal = () => {
                setShowModal(false);
                setSelectedDay(null);
                setSelectedFiles([]);
                setSelectedPlatforms([]);
                setCaptionInput('');
            };

            const handleFileChange = (event) => {
                const files = Array.from(event.target.files);
                const validFiles = files.filter(file => {
                    if (!file.type.startsWith('image/') && !file.type.startsWith('video/')) {
                        showTemporaryMessage(`æ–‡ä»¶ ${file.name} ä¸æ˜¯æœ‰æ•ˆçš„å›¾ç‰‡æˆ–è§†é¢‘æ–‡ä»¶ã€‚`, 'error');
                        return false;
                    }
                    return true;
                });
                setSelectedFiles(prevFiles => [...prevFiles, ...validFiles]);
            };

            const removeSelectedFile = (indexToRemove) => {
                setSelectedFiles(prevFiles => prevFiles.filter((_, index) => index !== indexToRemove));
            };

            // å‹ç¼©å›¾ç‰‡å‡½æ•°
            const compressImage = (file, maxWidth = 1920, quality = 0.8) => {
                return new Promise((resolve) => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const img = new Image();
                    
                    img.onload = () => {
                        const ratio = Math.min(maxWidth / img.width, maxWidth / img.height);
                        canvas.width = img.width * ratio;
                        canvas.height = img.height * ratio;
                        
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        resolve(canvas.toDataURL('image/jpeg', quality));
                    };
                    
                    img.src = URL.createObjectURL(file);
                });
            };

            // åˆ›å»ºè§†é¢‘ç¼©ç•¥å›¾
            const createVideoThumbnail = (file) => {
                return new Promise((resolve) => {
                    const video = document.createElement('video');
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    video.onloadedmetadata = () => {
                        canvas.width = Math.min(video.videoWidth, 800);
                        canvas.height = Math.min(video.videoHeight, 600);
                        
                        video.currentTime = 1; // è·å–ç¬¬1ç§’çš„å¸§
                    };
                    
                    video.onseeked = () => {
                        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                        resolve(canvas.toDataURL('image/jpeg', 0.7));
                    };
                    
                    video.src = URL.createObjectURL(file);
                });
            };

            const openLightbox = (media) => {
                setLightboxMedia(media);
            };

            const closeLightbox = () => {
                setLightboxMedia(null);
            };

            // è¯·æ±‚é€šçŸ¥æƒé™
            const requestNotificationPermission = async () => {
                if ('Notification' in window) {
                    const permission = await Notification.requestPermission();
                    if (permission === 'granted') {
                        setNotificationsEnabled(true);
                        localStorage.setItem('notificationsEnabled', 'true');
                        showTemporaryMessage('é€šçŸ¥æƒé™å·²å¼€å¯ï¼Œæˆ‘ä»¬ä¼šåœ¨å‘å¸ƒæ—¶é—´æé†’æ‚¨', 'success');
                } else {
                        showTemporaryMessage('éœ€è¦å¼€å¯é€šçŸ¥æƒé™æ‰èƒ½ä½¿ç”¨æé†’åŠŸèƒ½', 'error');
                    }
                } else {
                    showTemporaryMessage('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒé€šçŸ¥åŠŸèƒ½', 'error');
                }
            };

            // å‘é€é€šçŸ¥æé†’
            const sendNotification = (title, body, data) => {
                if (notificationsEnabled && 'Notification' in window && Notification.permission === 'granted') {
                    const notification = new Notification(title, {
                        body: body,
                        icon: '/favicon.ico',
                        badge: '/favicon.ico',
                        tag: 'social-media-reminder',
                        data: data
                    });
                    
                    notification.onclick = () => {
                        window.focus();
                        notification.close();
                    };
                }
            };

            // æ£€æŸ¥ä»Šæ—¥å¾…å‘å¸ƒå†…å®¹
            const checkTodaysPosts = () => {
                const today = getToday().toISOString().split('T')[0];
                const todaysPosts = scheduledPosts[today] || [];
                
                if (todaysPosts.length > 0) {
                    const platforms = todaysPosts[0].platforms || [];
                    const caption = todaysPosts[0].caption || '';
                    const hasFiles = todaysPosts[0].files && todaysPosts[0].files.length > 0;
                    
                    let contentType = hasFiles ? `${todaysPosts[0].files.length}ä¸ªåª’ä½“æ–‡ä»¶` : 'æ–‡å­—å†…å®¹';
                    
                    sendNotification(
                        'ğŸ“… ä»Šæ—¥å‘å¸ƒæé†’',
                        `æ‚¨æœ‰å†…å®¹éœ€è¦å‘å¸ƒåˆ°ï¼š${platforms.join('ã€')}\\nå†…å®¹ï¼š${contentType}`,
                        { date: today, platforms, caption }
                    );
                }
            };

            // è½®æ’­é€»è¾‘
            React.useEffect(() => {
                const intervals = {};
                
                Object.keys(scheduledPosts).forEach(dayKey => {
                    const posts = scheduledPosts[dayKey];
                    if (posts.length > 0 && posts[0].files && posts[0].files.length > 1) {
                        intervals[dayKey] = setInterval(() => {
                            setCarouselIndices(prev => ({
                                ...prev,
                                [dayKey]: ((prev[dayKey] || 0) + 1) % posts[0].files.length
                            }));
                        }, 3000); // æ¯3ç§’åˆ‡æ¢
                    }
                });

                return () => {
                    Object.values(intervals).forEach(interval => clearInterval(interval));
                };
            }, [scheduledPosts]);

            const getMonthYear = () => {
                return currentDate.toLocaleString('zh-CN', { month: 'long', year: 'numeric' });
            };

            const getDaysInMonth = (date) => {
                return new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
            };

            const getFirstDayOfMonth = (date) => {
                return new Date(date.getFullYear(), date.getMonth(), 1).getDay();
            };

            const getToday = () => {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                return today;
            };

            const renderCalendarDays = () => {
                const totalDays = getDaysInMonth(currentDate);
                const firstDayIndex = getFirstDayOfMonth(currentDate);
                const days = [];
                const today = getToday();

                for (let i = 0; i < firstDayIndex; i++) {
                    days.push(
                        <div key={`empty-${i}`} className="flex flex-col">
                            <div className="aspect-9-16 calendar-cell bg-white"></div>
                            <div className="flex justify-center py-2">
                                <span className="text-transparent text-sm">+</span>
                            </div>
                        </div>
                    );
                }

                for (let day = 1; day <= totalDays; day++) {
                    const currentDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
                    currentDay.setHours(0, 0, 0, 0);
                    const dayKey = currentDay.toISOString().split('T')[0];
                    const postsForDay = scheduledPosts[dayKey] || [];

                    let cellClass = 'calendar-cell bg-white';
                    if (currentDay.getTime() === today.getTime()) {
                        cellClass = 'calendar-cell today-cell';
                    } else if (currentDay.getTime() < today.getTime()) {
                        cellClass = 'calendar-cell past-cell';
                    }

                    days.push(
                        <div key={dayKey} className="flex flex-col">
                            <div className={`relative ${cellClass} aspect-9-16`}>
                                <div className="absolute top-2 left-2 text-xs text-gray-400 z-10" style={{fontWeight: 300}}>{day}</div>
                                
                                {/* ä¸»è¦å†…å®¹åŒºåŸŸ - å æ»¡æ•´ä¸ªæ ¼å­ */}
                                {postsForDay.length > 0 ? (
                                    postsForDay[0].files && postsForDay[0].files.length > 0 ? (
                                    <div className="relative group media-container">
                                        {/* åˆ é™¤æŒ‰é’® */}
                                        <button
                                            onClick={() => removeMedia(currentDay, 0)}
                                            className="absolute top-2 right-2 z-20 opacity-0 group-hover:opacity-100 transition-opacity bg-white rounded-full p-1 shadow-md hover:bg-gray-50"
                                            title="åˆ é™¤å†…å®¹"
                                        >
                                            <XCircle size={12} className="text-gray-600" />
                                        </button>
                                        
                                        {/* å¤šä¸ªæ–‡ä»¶æ—¶æ˜¾ç¤ºè½®æ’­æŒ‡ç¤ºå™¨ */}
                                        {postsForDay[0].files.length > 1 && (
                                            <div className="absolute bottom-2 left-1/2 transform -translate-x-1/2 z-10 flex space-x-1 bg-black bg-opacity-30 px-2 py-1 rounded-full">
                                                {postsForDay[0].files.map((_, index) => (
                                                    <div
                                                        key={index}
                                                        className={`w-1.5 h-1.5 rounded-full carousel-indicator ${
                                                            index === (carouselIndices[dayKey] || 0) 
                                                                ? 'bg-white' 
                                                                : 'bg-white bg-opacity-50'
                                                        }`}
                                                    />
                                                ))}
                                            </div>
                                        )}
                                        
                                        {(() => {
                                            const currentFileIndex = carouselIndices[dayKey] || 0;
                                            const currentFile = postsForDay[0].files[currentFileIndex];
                                            
                                            if (currentFile.type === 'image') {
                                                return (
                                                    <img
                                                        src={currentFile.dataUrl || currentFile.originalDataUrl}
                                                        alt="å†…å®¹å›¾ç‰‡"
                                                        className="cursor-pointer"
                                                        onClick={() => openLightbox({
                                                            ...currentFile,
                                                            dataUrl: currentFile.originalDataUrl || currentFile.dataUrl,
                                                            caption: postsForDay[0].caption
                                                        })}
                                                    />
                                                );
                                            } else {
                                                return (
                                                    <div 
                                                        className="w-full h-full cursor-pointer"
                                                        onClick={() => openLightbox({
                                                            ...currentFile,
                                                            dataUrl: currentFile.originalDataUrl,
                                                            caption: postsForDay[0].caption
                                                        })}
                                                    >
                                                        {currentFile.thumbnail ? (
                                                            <img
                                                                src={currentFile.thumbnail}
                                                                alt="è§†é¢‘ç¼©ç•¥å›¾"
                                                            />
                                                        ) : (
                                                            <video
                                                                src={currentFile.originalDataUrl}
                                                                muted
                                                            />
                                                        )}
                                        </div>
                                                );
                                            }
                                        })()}
                                    </div>
                                    ) : (
                                        // çº¯æ–‡å­—æ˜¾ç¤º
                                        postsForDay[0].caption && (
                                            <div className="relative group w-full h-full">
                                                {/* åˆ é™¤æŒ‰é’® */}
                                            <button
                                                    onClick={() => removeMedia(currentDay, 0)}
                                                    className="absolute top-2 right-2 z-20 opacity-0 group-hover:opacity-100 transition-opacity bg-white rounded-full p-1 shadow-md hover:bg-gray-50"
                                                title="åˆ é™¤å†…å®¹"
                                            >
                                                    <XCircle size={12} className="text-gray-600" />
                                            </button>
                                                
                                                <div 
                                                    className="w-full h-full p-3 cursor-pointer bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-100 hover:from-blue-100 hover:to-indigo-100 transition-colors flex items-center justify-center"
                                                    onClick={() => openLightbox({
                                                        type: 'text',
                                                        caption: postsForDay[0].caption
                                                    })}
                                                >
                                                    <p className="text-gray-700 text-xs leading-relaxed text-center line-clamp-6 font-medium">
                                                        {postsForDay[0].caption.length > 60 
                                                            ? postsForDay[0].caption.substring(0, 60) + '...' 
                                                            : postsForDay[0].caption
                                                        }
                                                    </p>
                                        </div>
                                    </div>
                                        )
                                    )
                                ) : null}
                            </div>
                            
                            {/* åº•éƒ¨æ·»åŠ æŒ‰é’® - å±…ä¸­æ˜¾ç¤º */}
                            <div className="flex justify-center py-2">
                            <button
                                onClick={() => openModal(currentDay)}
                                    className="text-gray-300 hover:text-gray-500 transition-colors text-sm"
                                    title="æ·»åŠ å†…å®¹"
                            >
                                    +
                            </button>
                            </div>
                        </div>
                    );
                }
                return days;
            };

            const handlePlatformChange = (platformName) => {
                setSelectedPlatforms(prevPlatforms => {
                    if (prevPlatforms.includes(platformName)) {
                        return prevPlatforms.filter(p => p !== platformName);
                    } else {
                        return [...prevPlatforms, platformName];
                    }
                });
            };

            const removeMedia = (day, indexToRemove) => {
                const dayKey = day.toISOString().split('T')[0];
                setScheduledPosts(prevPosts => {
                    const updatedPosts = { ...prevPosts };
                    if (updatedPosts[dayKey]) {
                        updatedPosts[dayKey] = updatedPosts[dayKey].filter((_, index) => index !== indexToRemove);
                        if (updatedPosts[dayKey].length === 0) {
                            delete updatedPosts[dayKey];
                        }
                    }
                    return updatedPosts;
                });
                showTemporaryMessage('å†…å®¹å·²åˆ é™¤ã€‚', 'error');
            };

            const clearAllData = () => {
                if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
                    setScheduledPosts({});
                    localStorage.removeItem('socialMediaCalendar');
                    showTemporaryMessage('æ‰€æœ‰æ•°æ®å·²æ¸…ç©ºã€‚', 'error');
                }
            };

            const exportData = () => {
                const dataStr = JSON.stringify(scheduledPosts, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `social-media-calendar-backup-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                URL.revokeObjectURL(url);
            };

            // å¯¼å‡ºä»Šæ—¥å†…å®¹
            const exportTodayContent = () => {
                const today = getToday().toISOString().split('T')[0];
                const todaysPosts = scheduledPosts[today] || [];
                
                if (todaysPosts.length === 0) {
                    showTemporaryMessage('ä»Šæ—¥æ²¡æœ‰å¾…å‘å¸ƒçš„å†…å®¹', 'error');
                    return;
                }

                let content = `ğŸ“… ${today} å‘å¸ƒå†…å®¹\\n\\n`;
                
                todaysPosts.forEach((post, index) => {
                    content += `ã€ç¬¬${index + 1}æ¡ã€‘\\n`;
                    content += `å¹³å°ï¼š${post.platforms.join('ã€')}\\n`;
                    if (post.caption) {
                        content += `æ–‡æ¡ˆï¼š${post.caption}\\n`;
                    }
                    if (post.files && post.files.length > 0) {
                        content += `åª’ä½“ï¼š${post.files.length}ä¸ªæ–‡ä»¶\\n`;
                    }
                    content += '\\n';
                });

                // å¤åˆ¶åˆ°å‰ªè´´æ¿
                navigator.clipboard.writeText(content).then(() => {
                    showTemporaryMessage('ä»Šæ—¥å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                }).catch(() => {
                    showTemporaryMessage('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'error');
                });
            };

            // å¿«é€Ÿå‘å¸ƒ - è·³è½¬åˆ°å¹³å°å‘å¸ƒé¡µé¢
            const quickPublish = (platform) => {
                const today = getToday().toISOString().split('T')[0];
                const todaysPosts = scheduledPosts[today] || [];
                
                if (todaysPosts.length === 0) {
                    showTemporaryMessage('ä»Šæ—¥æ²¡æœ‰å¾…å‘å¸ƒçš„å†…å®¹', 'error');
                    return;
                }

                const post = todaysPosts[0];
                const caption = post.caption || '';
                
                // å¹³å°å‘å¸ƒé¡µé¢URL
                const publishUrls = {
                    'IG': 'https://www.instagram.com/',
                    'FB': 'https://www.facebook.com/',
                    'å°çº¢ä¹¦': 'https://www.xiaohongshu.com/explore',
                    'æŠ–éŸ³': 'https://www.douyin.com/',
                    'å¾®åš': 'https://weibo.com/u/page/publish',
                    'å¾®ä¿¡': 'https://mp.weixin.qq.com/'
                };

                // å¤åˆ¶æ–‡æ¡ˆåˆ°å‰ªè´´æ¿
                if (caption) {
                    navigator.clipboard.writeText(caption).then(() => {
                        showTemporaryMessage(`æ–‡æ¡ˆå·²å¤åˆ¶ï¼Œæ­£åœ¨è·³è½¬åˆ°${platform}`, 'success');
                        setTimeout(() => {
                            window.open(publishUrls[platform], '_blank');
                        }, 1000);
                    }).catch(() => {
                        showTemporaryMessage('å¤åˆ¶å¤±è´¥ï¼Œä½†ä»ä¼šè·³è½¬åˆ°å‘å¸ƒé¡µé¢', 'error');
                        window.open(publishUrls[platform], '_blank');
                    });
                } else {
                    window.open(publishUrls[platform], '_blank');
                }
            };

            const addMediaToDay = () => {
                if (selectedFiles.length === 0 && !captionInput.trim()) {
                    showTemporaryMessage('è¯·ä¸Šä¼ å›¾ç‰‡/è§†é¢‘æˆ–è¾“å…¥æ–‡æ¡ˆã€‚', 'error');
                    return;
                }
                if (selectedPlatforms.length === 0) {
                    showTemporaryMessage('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªå‘å¸ƒå¹³å°ã€‚', 'error');
                    return;
                }

                const dayKey = selectedDay.toISOString().split('T')[0];
                const newPost = {
                    platforms: selectedPlatforms,
                    caption: captionInput.trim(),
                    files: []
                };

                if (selectedFiles.length > 0) {
                    const filePromises = selectedFiles.map(async (file) => {
                        if (file.type.startsWith('image/')) {
                            // å‹ç¼©å›¾ç‰‡
                            const compressedDataUrl = await compressImage(file);
                            return {
                                type: 'image',
                                dataUrl: compressedDataUrl,
                                originalDataUrl: URL.createObjectURL(file), // ä¿ç•™åŸå§‹æ–‡ä»¶å¼•ç”¨
                                name: file.name,
                                size: file.size
                            };
                        } else if (file.type.startsWith('video/')) {
                            // ä¸ºè§†é¢‘åˆ›å»ºç¼©ç•¥å›¾ï¼Œä¿ç•™åŸå§‹æ–‡ä»¶å¼•ç”¨
                            try {
                                const thumbnail = await createVideoThumbnail(file);
                                return {
                                    type: 'video',
                                    thumbnail: thumbnail, // ç¼©ç•¥å›¾ç”¨äºæ˜¾ç¤º
                                    originalDataUrl: URL.createObjectURL(file), // åŸå§‹è§†é¢‘æ–‡ä»¶
                                    name: file.name,
                                    size: file.size,
                                    isLargeFile: true // æ ‡è®°ä¸ºå¤§æ–‡ä»¶
                                };
                            } catch (error) {
                                console.error('åˆ›å»ºè§†é¢‘ç¼©ç•¥å›¾å¤±è´¥:', error);
                                return {
                                    type: 'video',
                                    originalDataUrl: URL.createObjectURL(file),
                                    name: file.name,
                                    size: file.size,
                                    isLargeFile: true
                                };
                            }
                        }
                    });

                    Promise.all(filePromises)
                        .then(fileData => {
                            newPost.files = fileData;
                            setScheduledPosts(prevPosts => {
                                const updatedPosts = { ...prevPosts };
                                if (!updatedPosts[dayKey]) {
                                    updatedPosts[dayKey] = [];
                                }
                                updatedPosts[dayKey].push(newPost);
                                return updatedPosts;
                            });
                            closeModal();
                        })
                        .catch(() => {
                            showTemporaryMessage('æ–‡ä»¶è¯»å–å¤±è´¥ã€‚', 'error');
                        });
                } else {
                    newPost.type = 'text';
                    setScheduledPosts(prevPosts => {
                        const updatedPosts = { ...prevPosts };
                        if (!updatedPosts[dayKey]) {
                            updatedPosts[dayKey] = [];
                        }
                        updatedPosts[dayKey].push(newPost);
                        return updatedPosts;
                    });
                    closeModal();
                }
            };

            return (
                <div className="min-h-screen bg-gray-50 p-4 md:p-6 font-sans antialiased">
                    <div className="max-w-7xl mx-auto bg-white relative">
                        
                        {/* é¡¶éƒ¨æ§åˆ¶æ  */}
                        <div className="flex justify-between items-start p-4 md:p-8 pb-4">
                            <div></div> {/* å·¦ä¾§å ä½ */}
                            <div className="text-sm text-gray-600 font-medium text-right">
                                <div className="flex flex-col items-end gap-2 mb-4">
                                {/* é€šçŸ¥å’Œä»Šæ—¥å†…å®¹æŒ‰é’® */}
                                <div className="flex gap-2 mb-2">
                                    <button
                                        onClick={requestNotificationPermission}
                                        className={`text-xs px-2 py-1 rounded transition-colors ${
                                            notificationsEnabled 
                                                ? 'bg-green-50 text-green-600 hover:bg-green-100' 
                                                : 'bg-orange-50 text-orange-600 hover:bg-orange-100'
                                        }`}
                                        title={notificationsEnabled ? 'é€šçŸ¥å·²å¼€å¯' : 'å¼€å¯å‘å¸ƒæé†’'}
                                    >
                                        {notificationsEnabled ? 'ğŸ”” å·²å¼€å¯' : 'ğŸ”• å¼€å¯æé†’'}
                                    </button>
                                    <button
                                        onClick={exportTodayContent}
                                        className="text-xs px-2 py-1 bg-purple-50 text-purple-600 rounded hover:bg-purple-100 transition-colors"
                                        title="å¤åˆ¶ä»Šæ—¥å‘å¸ƒå†…å®¹"
                                    >
                                        ğŸ“‹ ä»Šæ—¥å†…å®¹
                                    </button>
                                </div>
                                
                                {/* å¿«é€Ÿå‘å¸ƒæŒ‰é’® */}
                                {(() => {
                                    const today = getToday().toISOString().split('T')[0];
                                    const todaysPosts = scheduledPosts[today] || [];
                                    if (todaysPosts.length > 0 && todaysPosts[0].platforms) {
                                        return (
                                            <div className="flex gap-1 mb-2 flex-wrap justify-end">
                                                {todaysPosts[0].platforms.map(platform => (
                                                    <button
                                                        key={platform}
                                                        onClick={() => quickPublish(platform)}
                                                        className="text-xs px-2 py-1 bg-blue-50 text-blue-600 rounded hover:bg-blue-100 transition-colors"
                                                        title={`å¿«é€Ÿå‘å¸ƒåˆ°${platform}`}
                                                    >
                                                        ğŸš€ {platform}
                                                    </button>
                                                ))}
                                            </div>
                                        );
                                    }
                                    return null;
                                })()}
                                
                                <div className="text-xs text-gray-500">
                                    å­˜å‚¨: {Object.keys(scheduledPosts).length} ä¸ªæ—¥æœŸ
                                </div>
                                <div className="flex gap-2">
                                    <button
                                        onClick={exportData}
                                        className="px-3 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600 transition-colors"
                                        title="å¯¼å‡ºæ•°æ®å¤‡ä»½"
                                    >
                                        å¯¼å‡º
                                    </button>
                                    <button
                                        onClick={clearAllData}
                                        className="px-3 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600 transition-colors"
                                        title="æ¸…ç©ºæ‰€æœ‰æ•°æ®"
                                    >
                                        æ¸…ç©º
                                    </button>
                                </div>
                                </div>
                                {currentTime.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric' })}
                                <br />
                                {currentTime.toLocaleTimeString('zh-CN')}
                            </div>
                        </div>
                        
                        {/* ä¸»è¦å†…å®¹åŒºåŸŸ */}
                        <div className="px-4 md:px-8 pb-4 md:pb-8">

                        {message.text && (
                            <div className={`p-3 mb-4 rounded-lg text-center font-medium ${message.type === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                                {message.text}
                            </div>
                        )}

                        <div className="flex items-center justify-center mb-8 gap-3">
                                <button
                                    onClick={prevMonth}
                                className="nav-button flex items-center justify-center w-12 h-12 text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-all text-2xl font-light rounded-full"
                                    aria-label="ä¸Šä¸ªæœˆ"
                                >
                                <ChevronLeft />
                                </button>
                            <h2 className="text-3xl md:text-4xl lg:text-5xl text-gray-400 tracking-widest uppercase" style={{fontWeight: 200}}>
                                    {getMonthYear()}
                                </h2>
                                <button
                                    onClick={nextMonth}
                                className="nav-button flex items-center justify-center w-12 h-12 text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-all text-2xl font-light rounded-full"
                                    aria-label="ä¸‹ä¸ªæœˆ"
                                >
                                <ChevronRight />
                                </button>
                            </div>

                        <div className="grid grid-cols-7 gap-0 mb-4 text-center text-gray-400 text-sm tracking-wider">
                            {['S', 'M', 'T', 'W', 'T', 'F', 'S'].map((day, index) => (
                                <div key={index} className="py-4" style={{fontWeight: 300}}>{day}</div>
                                    ))}
                                </div>

                        <div className="grid grid-cols-7 gap-0">
                                    {renderCalendarDays()}
                                </div>
                    </div>

                    {showModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                            <div className="bg-white rounded-lg p-6 w-full max-w-md shadow-xl transform transition-all scale-100">
                                <h3 className="text-2xl font-bold text-gray-800 mb-4 text-center">
                                    æ·»åŠ å†…å®¹åˆ° {selectedDay?.toLocaleDateString('zh-CN')}
                                </h3>

                                <div className="mb-4">
                                    <label htmlFor="mediaUpload" className="block text-gray-700 text-sm font-medium mb-2">
                                        ä¸Šä¼ å›¾ç‰‡æˆ–è§†é¢‘ (å¯é€‰)
                                    </label>
                                    <div className="flex items-center justify-center w-full">
                                        <label
                                            htmlFor="mediaUpload"
                                            className="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors"
                                        >
                                            <div className="flex flex-col items-center justify-center pt-5 pb-6">
                                                <UploadCloud className="text-gray-400 mb-2 text-2xl" />
                                                <p className="mb-2 text-sm text-gray-500">
                                                    <span className="font-semibold">ç‚¹å‡»ä¸Šä¼ </span> æˆ–æ‹–æ”¾æ–‡ä»¶ (æ”¯æŒå¤šé€‰)
                                                </p>
                                                <p className="text-xs text-gray-500">æ”¯æŒå›¾ç‰‡ (JPG, PNG, GIF) æˆ–è§†é¢‘ (MP4, MOV)</p>
                                            </div>
                                            <input
                                                id="mediaUpload"
                                                type="file"
                                                className="hidden"
                                                accept="image/*,video/*"
                                                multiple
                                                onChange={handleFileChange}
                                            />
                                        </label>
                                    </div>
                                    {selectedFiles.length > 0 && (
                                        <div className="mt-2">
                                            <div className="flex justify-between items-center mb-2">
                                                <p className="text-sm text-gray-600">å·²é€‰æ‹© {selectedFiles.length} ä¸ªæ–‡ä»¶</p>
                                                <button
                                                    onClick={() => setSelectedFiles([])}
                                                    className="text-red-500 hover:text-red-600 transition-colors"
                                                    title="æ¸…ç©ºæ‰€æœ‰æ–‡ä»¶"
                                                >
                                                    æ¸…ç©ºå…¨éƒ¨
                                                </button>
                                            </div>
                                            <div className="grid grid-cols-2 gap-2 max-h-48 overflow-y-auto custom-scrollbar">
                                                {selectedFiles.map((file, index) => (
                                                    <div key={index} className="relative">
                                                        <button
                                                            onClick={() => removeSelectedFile(index)}
                                                            className="absolute top-1 right-1 z-10 bg-blue-500 text-white rounded-full p-1 hover:bg-blue-600 transition-colors"
                                                            title="åˆ é™¤æ­¤æ–‡ä»¶"
                                                        >
                                                            <XCircle size={12} />
                                                        </button>
                                                        {file.type.startsWith('image/') ? (
                                                            <img
                                                                src={URL.createObjectURL(file)}
                                                                alt={`é¢„è§ˆ ${index + 1}`}
                                                                className="w-full h-20 object-cover rounded-md cursor-pointer hover:opacity-80 transition-opacity"
                                                                style={{
                                                                    objectPosition: 'center'
                                                                }}
                                                                onClick={() => openLightbox({type: 'image', dataUrl: URL.createObjectURL(file), name: file.name})}
                                                                title="ç‚¹å‡»æŸ¥çœ‹å¤§å›¾"
                                                            />
                                                        ) : (
                                                            <div 
                                                                className="relative cursor-pointer hover:opacity-80 transition-opacity"
                                                                onClick={() => openLightbox({type: 'video', dataUrl: URL.createObjectURL(file), name: file.name})}
                                                                title="ç‚¹å‡»å…¨å±æ’­æ”¾"
                                                            >
                                                                <video
                                                                    src={URL.createObjectURL(file)}
                                                                    className="w-full h-20 object-cover rounded-md"
                                                                    style={{
                                                                        objectPosition: 'center'
                                                                    }}
                                                                    muted
                                                                >
                                                                    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ ‡ç­¾ã€‚
                                                                </video>
                                                                <div className="absolute inset-0 flex items-center justify-center bg-black bg-opacity-30 rounded-md">
                                                                    <span className="text-white text-lg">â–¶</span>
                                                                </div>
                                                            </div>
                                                        )}
                                                        <p className="text-xs text-gray-600 mt-1 truncate">{file.name}</p>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>

                                <div className="mb-4">
                                    <label htmlFor="captionInput" className="block text-gray-700 text-sm font-medium mb-2">
                                        æ–‡æ¡ˆ
                                    </label>
                                    <textarea
                                        id="captionInput"
                                        value={captionInput}
                                        onChange={(e) => setCaptionInput(e.target.value)}
                                        rows="3"
                                        placeholder="è¾“å…¥æ‚¨çš„å‘å¸ƒæ–‡æ¡ˆ..."
                                        className="w-full p-3 border border-gray-300 rounded-md focus:ring-gray-500 focus:border-gray-500 transition-colors resize-y"
                                    ></textarea>
                                </div>

                                <div className="mb-6">
                                    <label className="block text-gray-700 text-sm font-medium mb-2">
                                        é€‰æ‹©å‘å¸ƒå¹³å°
                                    </label>
                                    <div className="grid grid-cols-2 gap-2">
                                        {platforms.map(platform => (
                                            <label key={platform.name} className="inline-flex items-center cursor-pointer">
                                                <input
                                                    type="checkbox"
                                                    value={platform.name}
                                                    checked={selectedPlatforms.includes(platform.name)}
                                                    onChange={() => handlePlatformChange(platform.name)}
                                                    className="form-checkbox h-5 w-5 text-gray-600 rounded focus:ring-gray-500"
                                                />
                                                <span className="ml-2 text-gray-700">{platform.name}</span>
                                            </label>
                                        ))}
                                    </div>
                                </div>

                                <div className="flex justify-end space-x-3">
                                    <button
                                        onClick={closeModal}
                                        className="px-5 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors font-medium"
                                    >
                                        å–æ¶ˆ
                                    </button>
                                    <button
                                        onClick={addMediaToDay}
                                        className="px-5 py-2 bg-gray-700 text-white rounded-md hover:bg-gray-800 transition-colors font-medium shadow-md"
                                    >
                                        æ·»åŠ 
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Lightbox Modal */}
                    {lightboxMedia && (
                        <div 
                            className="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4"
                            onClick={closeLightbox}
                        >
                            <div className="flex max-w-7xl max-h-full w-full gap-6" onClick={(e) => e.stopPropagation()}>
                                <button
                                    onClick={closeLightbox}
                                    className="absolute top-6 right-6 z-60 bg-white bg-opacity-20 text-white rounded-full p-2 hover:bg-opacity-30 transition-colors"
                                    title="å…³é—­"
                                >
                                    <XCircle size={24} />
                                </button>
                                
                                {/* åª’ä½“å†…å®¹åŒºåŸŸ */}
                                <div className="flex-1 flex items-center justify-center">
                                    {lightboxMedia.type === 'image' ? (
                                        <img
                                            src={lightboxMedia.dataUrl}
                                            alt={lightboxMedia.name}
                                            className="max-w-full max-h-full object-contain rounded-lg"
                                        />
                                    ) : lightboxMedia.type === 'video' ? (
                                        <video
                                            src={lightboxMedia.dataUrl}
                                            controls
                                            autoPlay
                                            className="max-w-full max-h-full object-contain rounded-lg"
                                        >
                                            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ ‡ç­¾ã€‚
                                        </video>
                                    ) : (
                                        // çº¯æ–‡å­—ç±»å‹ - ä¸æ˜¾ç¤ºåª’ä½“å†…å®¹ï¼Œåªæ˜¾ç¤ºå³ä¾§æ–‡å­—é¢æ¿
                                        <div className="flex items-center justify-center text-gray-400 text-xl">
                                            ğŸ“ æ–‡å­—å†…å®¹
                                        </div>
                                    )}
                                </div>
                                
                                {/* æ–‡å­—å†…å®¹åŒºåŸŸ */}
                                {lightboxMedia.caption && (
                                    <div className="w-80 bg-white rounded-lg p-6 flex flex-col max-h-full">
                                        <div className="flex items-center justify-between mb-4">
                                            <h3 className="text-lg font-semibold text-gray-800">æ–‡æ¡ˆå†…å®¹</h3>
                                            <button
                                                onClick={async () => {
                                                    try {
                                                        await navigator.clipboard.writeText(lightboxMedia.caption);
                                                        showTemporaryMessage('æ–‡æ¡ˆå·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                                                    } catch (err) {
                                                        showTemporaryMessage('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'error');
                                                    }
                                                }}
                                                className="px-3 py-1 bg-blue-500 text-white text-sm rounded-md hover:bg-blue-600 transition-colors flex items-center gap-1"
                                                title="å¤åˆ¶æ–‡æ¡ˆ"
                                            >
                                                ğŸ“‹ å¤åˆ¶
                                            </button>
                                        </div>
                                        <div className="flex-1 overflow-y-auto border rounded-md p-4 bg-gray-50">
                                            <p className="text-gray-700 leading-relaxed whitespace-pre-wrap text-base font-normal">
                                                {lightboxMedia.caption}
                                            </p>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                        </div> {/* å…³é—­ä¸»è¦å†…å®¹åŒºåŸŸ */}
                    </div> {/* å…³é—­ä¸»å®¹å™¨ */}
                </div> {/* å…³é—­æœ€å¤–å±‚å®¹å™¨ */}
            );
        };

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>